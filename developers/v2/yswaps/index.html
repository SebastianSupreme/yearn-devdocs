<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Yearn.finance" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">ySwaps | Yearn.finance</title><meta data-react-helmet="true" property="og:image" content="https://docs.yearn.finance/img/YFILogoGradient.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.yearn.finance/img/YFILogoGradient.png"><meta data-react-helmet="true" property="og:url" content="https://docs.yearn.finance/developers/v2/yswaps"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-developers-current"><meta data-react-helmet="true" name="twitter:card" content="Yearn Finance is a suite of products in Decentralized Finance (DeFi) that provides lending aggregation, yield generation, and insurance on the Ethereum blockchain."><meta data-react-helmet="true" property="og:title" content="ySwaps | Yearn.finance"><meta data-react-helmet="true" name="description" content="ySwaps is used to abstract the token trading logic from the strategies harvest method, which means strategies can focus on farming tokens and don&#x27;t have to handle tokens trading logic and paths. The &quot;swappers&quot; smart contracts allows trading optimizations and new paths to be added since the code is not hardcoded in strategies."><meta data-react-helmet="true" property="og:description" content="ySwaps is used to abstract the token trading logic from the strategies harvest method, which means strategies can focus on farming tokens and don&#x27;t have to handle tokens trading logic and paths. The &quot;swappers&quot; smart contracts allows trading optimizations and new paths to be added since the code is not hardcoded in strategies."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.yearn.finance/developers/v2/yswaps"><link data-react-helmet="true" rel="alternate" href="https://docs.yearn.finance/developers/v2/yswaps" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.yearn.finance/developers/v2/yswaps" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://UNKNOWN-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.de2eed67.css">
<link rel="preload" href="/assets/js/runtime~main.51de5865.js" as="script">
<link rel="preload" href="/assets/js/main.a1e4fa57.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Yearn Finance</b></a><a class="navbar__item navbar__link" href="/getting-started/intro">Getting Started</a><a class="navbar__item navbar__link" href="/developers/v2/getting-started">Develop</a><a class="navbar__item navbar__link" href="/partners/introduction">Partner</a><a class="navbar__item navbar__link" href="/contributing/contribute">Contribute</a><a class="navbar__item navbar__link" href="/resources/faq">Resources</a><a class="navbar__item navbar__link" href="/security/index">Security</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/vaults/smart-contracts/BaseStrategy">0.4.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/vaults/smart-contracts/BaseStrategy">0.4.3</a></li><li><a class="dropdown__link" href="/vaults/0.4.2/getting-started">0.4.2</a></li><li><a class="dropdown__link" href="/vaults/0.3.5/getting-started">0.3.5</a></li><li><a class="dropdown__link" href="/vaults/0.3.4/getting-started">0.3.4</a></li><li><a class="dropdown__link" href="/vaults/0.3.3/getting-started">0.3.3</a></li><li><a class="dropdown__link" href="/vaults/0.3.2/getting-started">0.3.2</a></li><li><a class="dropdown__link" href="/vaults/0.3.1/getting-started">0.3.1</a></li><li><a class="dropdown__link" href="/vaults/0.3.0/getting-started">0.3.0</a></li></ul></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT" style="margin-left:0px;background-color:transparent"> </span></div><div class="react-toggle-track-x"><span class="toggle_71bT" style="margin-left:0px;background-color:transparent">Â </span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="YFI Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Yearn Finance</b></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/developers/v2/getting-started">Getting Started with Vaults and Strategies</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/developers/v2/additional-resources">Additional Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Procedures</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/vaults/smart-contracts/BaseStrategy">Smart Contracts</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/developers/v2/hacking-with-yearn">Hacking on Yearn</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/developers/v2/yswaps">ySwaps</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ySwaps</h1></header><p>ySwaps is used to <strong>abstract</strong> the token trading logic from the strategies harvest method, which means strategies can focus on farming tokens and don&#x27;t have to handle tokens trading logic and paths. The &quot;swappers&quot; smart contracts allows trading optimizations and new paths to be added since the code is not hardcoded in strategies.</p><ul><li><a href="https://github.com/yearn/yswaps" target="_blank" rel="noopener noreferrer">ySwaps contracts repository</a></li><li><a href="https://github.com/yearn/yswaps-app" target="_blank" rel="noopener noreferrer">ySwaps scripts repository</a></li></ul><p><img src="https://i.imgur.com/VynhCU4.png" alt="yswaps-intro-diagram"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="glossary"></a>Glossary<a class="hash-link" href="#glossary" title="Direct link to heading">#</a></h2><ul><li><code>sms</code>: Strategists multisig</li><li><code>tokenIn</code>:  Token we have and we want to trade/swap</li><li><code>toeknOut</code>: Token we want to obtain on the swap</li><li><code>hopToken</code>: Token we use as a middle step between tokenIn and tokenOut</li><li><code>tf</code>: Trade Factory</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="components"></a>Components<a class="hash-link" href="#components" title="Direct link to heading">#</a></h2><ul><li><a href="#swappers">Swappers</a></li><li><a href="#trade-factory">Trade Factory</a></li><li><a href="#solvers">Solvers</a></li><li><a href="#dexes-libraries">Dexes Libraries</a></li><li><a href="#execute-script">Execute script</a></li><li><a href="#extra-toolings">Extra toolings</a></li><li><a href="#procedures">Procedures</a></li><li><a href="#keep3r-jobs">Keep3r Jobs</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="swappers"></a>Swappers<a class="hash-link" href="#swappers" title="Direct link to heading">#</a></h3><p>Contracts in charge of making the swaps (uniswap, balancer, sushiswap, solidly and more). We can separated them in two types:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="single-swapper"></a>Single swapper<a class="hash-link" href="#single-swapper" title="Direct link to heading">#</a></h4><p>Uniswap, balancer, sushiswap, etc. These are straighforward contracts that will make a simple swap on these dexes (<code>token A</code> to <code>token B</code>). It is also worth to mention that these swappers take care of few extra stuff like: <code>approval needed to make the swap</code>, <code>transfering final tokens to strategy if needed</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="multicall-swapper"></a>Multicall swapper<a class="hash-link" href="#multicall-swapper" title="Direct link to heading">#</a></h4><p>This contract will receive a bundle of transactions that are required to aquire the wanted token/tokens. This is used in specific cases where trade can not be made in a normal exchange due to liquidity issues, dex not having that token or route, needing extra steps to aquire the token such as depositing or withdrawing, and more. It is important to mention that this swapper does NOT take care of things like approvals, or transfers (important difference with <code>single swappers</code>).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="swappers-usage"></a>Swappers Usage<a class="hash-link" href="#swappers-usage" title="Direct link to heading">#</a></h4><p><strong>Single swapper example:</strong> We have <code>tokenIn</code> and <code>tokenOut</code> and we know that we can go straight to sushiswap that has enought liquidity to make the trade with good conditions.</p><p><strong>Multicall example:</strong> We have a <code>tokenIn</code> and we want a <code>tokenOut</code>. But theres no path on any dex to do the trade directly, so we need to split the swap in two steps:</p><ol><li>Step 1: <code>tokenIn</code> for <code>hopToken</code>.</li><li>Step 2: <code>hopToken</code> for <code>tokenOut</code>.</li></ol><p>For this example we are gonna assume that we will need to use two different dexes for each step. Since we are gonna split the trade in two different transactions and the main objective is to use TWO DIFFERENT dexes, this is where we use the <code>Multicall Swapper</code>.Everything that requires more than just a single swap tx, will use multicall dexes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="swapper-contracts-version-020"></a>Swapper Contracts (version 0.2.0)<a class="hash-link" href="#swapper-contracts-version-020" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="ethereum"></a>Ethereum<a class="hash-link" href="#ethereum" title="Direct link to heading">#</a></h5><ul><li>MultiCallOptimizedSwapper: <a href="https://etherscan.io/address/0x711d1D8E8B2b468c92c202127A2BBFEFC14bf105" target="_blank" rel="noopener noreferrer">0x711d1D8E8B2b468c92c202127A2BBFEFC14bf105</a></li><li>ZRX <a href="https://etherscan.io/address/0xE32dd1F66365289b7fe14e503CBB336cD5D13F09" target="_blank" rel="noopener noreferrer">0xE32dd1F66365289b7fe14e503CBB336cD5D13F09</a></li><li>AsyncBancor <a href="https://etherscan.io/address/0xf13b8F103690FD74B5F137eC3CF679a9D1B4BA95" target="_blank" rel="noopener noreferrer">0xf13b8F103690FD74B5F137eC3CF679a9D1B4BA95</a></li><li>AsyncSushiswap <a href="https://etherscan.io/address/0x408Ec47533aEF482DC8fA568c36EC0De00593f44" target="_blank" rel="noopener noreferrer">0x408Ec47533aEF482DC8fA568c36EC0De00593f44</a></li><li>AsyncUniswapV2 <a href="https://etherscan.io/address/0xA780b6A733D06dFf526A84c4258616b75279C763" target="_blank" rel="noopener noreferrer">0xA780b6A733D06dFf526A84c4258616b75279C763</a></li><li>OneInchAggregator <a href="https://etherscan.io/address/0x934D1c4ba7DF902d6cd0803882876e3C999cb406" target="_blank" rel="noopener noreferrer">0x934D1c4ba7DF902d6cd0803882876e3C999cb406</a></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="fantom"></a>Fantom<a class="hash-link" href="#fantom" title="Direct link to heading">#</a></h5><ul><li>ZRX: <a href="https://ftmscan.com/address/0x0a94017DF3f8981Da97D79c28b103bAbDa0D67C7" target="_blank" rel="noopener noreferrer">0x0a94017DF3f8981Da97D79c28b103bAbDa0D67C7</a></li><li>MultiCallOptimizedSwapper: <a href="https://ftmscan.com/address/0x590B3e12Ded77dE66CBF45050cD07a65d1F51dDD" target="_blank" rel="noopener noreferrer">0x590B3e12Ded77dE66CBF45050cD07a65d1F51dDD</a></li><li>AsyncSolidly: <a href="https://ftmscan.com/address/0x2cb391afd5180a31d01bE95Bd61A757594C9295a" target="_blank" rel="noopener noreferrer">0x2cb391afd5180a31d01bE95Bd61A757594C9295a</a></li><li>AsyncSpiritswap: <a href="https://ftmscan.com/address/0x8d2aFF696F14b287a6E759F4bfFB6f08E92DFD20" target="_blank" rel="noopener noreferrer">0x8d2aFF696F14b287a6E759F4bfFB6f08E92DFD20</a></li><li>AsyncSpookyswap: <a href="https://ftmscan.com/address/0x86ee473C2eE7eB97Ee0276bE43427a6CF0cC6348" target="_blank" rel="noopener noreferrer">0x86ee473C2eE7eB97Ee0276bE43427a6CF0cC6348</a></li><li>SyncSpiritswap: <a href="https://ftmscan.com/address/0x923D22FE66C77E2fea215050F088AE26186F96aE" target="_blank" rel="noopener noreferrer">0x923D22FE66C77E2fea215050F088AE26186F96aE</a></li><li>SyncSpookyswap: <a href="https://ftmscan.com/address/0xcD00a47D9fB36B0B37D589E20fE4fB7e2D9d9e8A" target="_blank" rel="noopener noreferrer">0xcD00a47D9fB36B0B37D589E20fE4fB7e2D9d9e8A</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="trade-factory"></a>Trade Factory<a class="hash-link" href="#trade-factory" title="Direct link to heading">#</a></h3><ul><li><p>This contract has the <code>enabled trades</code> that each strategy can make. Enabled trades are just a list of possible swaps that a strategy can make. So it only contains three variables: <code>strategyAddress</code>, <code>tokenIn</code>, <code>tokenOut</code>. We have these enabled trades to know which swaps can/should be made with each strategy.</p></li><li><p>This contract is also in changer of verifying the trades. To do that it will use the different <code>execute</code> methods in it and call the <code>swapper contracts</code> that needs to use. Remember that <code>swappers</code> are the contracts responsible to making the actual swap.</p></li><li><p>When we execute the swap its important to point out that this  takes care of: <code>transfering tokenIn from strat to swapper</code>, <code>make final the check if the amount received &gt; minAmountOut</code>.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="trade-factory-contracts-version-020"></a>Trade Factory Contracts (version 0.2.0)<a class="hash-link" href="#trade-factory-contracts-version-020" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="ethereum-1"></a>Ethereum<a class="hash-link" href="#ethereum-1" title="Direct link to heading">#</a></h5><ul><li>TradeFactory: <a href="https://etherscan.io/address/0x7BAF843e06095f68F4990Ca50161C2C4E4e01ec6" target="_blank" rel="noopener noreferrer">0x7BAF843e06095f68F4990Ca50161C2C4E4e01ec6</a></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="fantom-1"></a>Fantom<a class="hash-link" href="#fantom-1" title="Direct link to heading">#</a></h5><ul><li>TradeFactory: <a href="https://ftmscan.com/address/0xD3f89C21719Ec5961a3E6B0f9bBf9F9b4180E9e9" target="_blank" rel="noopener noreferrer">0xD3f89C21719Ec5961a3E6B0f9bBf9F9b4180E9e9</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="solvers-scripts"></a>Solvers Scripts<a class="hash-link" href="#solvers-scripts" title="Direct link to heading">#</a></h3><p>Scripts in charge of providing the swap transaction that will be used and sent to <code>Trade Factory contract</code>.</p><ul><li><p><strong>Custom solvers</strong>: There are custom solvers for specific cases/strategies that will need to make multiple transactions for a specific swap. Each of these scripts aims to an specific strategy and trade that needs to be made. Some examples (<code>ThreePoolCrvMulticall.ts</code>). This is for specific strategies&#x27;s trades that will need to swap tokens that can not be swaped/resolved on a single dex swap. The tx provided by this solver is gonna be used with the <code>Multicall swapper</code>.</p></li><li><p><strong>Dexes solvers</strong>: this script is used for situations where the trade can be resolved with a normal swap on an exchange and does NOT require multiple tx to ensure the trade is possible. Different to <code>Custom Solvers</code>, this can be used in a generic way for different strategies/swaps. This script checks with every DeX and chooses the best one to make the trade. The tx provided by this solver is gonna be used with the <code>Single swapper</code>.</p></li><li><p><strong>Multicall Dexes solvers</strong>: This solver is gonna split the trade in different steps using the <code>hopTokens</code> provided by us. Each step of the swap will loop between every dexes library and will take the best dex for each step of the trade. This solver generally will be using the <code>MulticallSwapper</code> since we are doing 2 steps or tx for the swap. But it is also possible to use the <code>SingleSwapper</code> because if both steps of the trade are using the same Dex, we should merge them into one for gas efficiency. We will be transformir <code>2 tx</code> into <code>1 tx</code> so we can use the <code>SingleSwapper</code>.</p></li></ul><br><ul><li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/solvers" target="_blank" rel="noopener noreferrer">All Solvers</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/solvers/Dexes.ts" target="_blank" rel="noopener noreferrer">Dexes Solver</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/solvers/MulticallDexes.ts" target="_blank" rel="noopener noreferrer">Multicall Dexes Solver</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="dexes-libraries"></a>Dexes Libraries<a class="hash-link" href="#dexes-libraries" title="Direct link to heading">#</a></h3><p>There is one dex library per dex (uniswap, bancor, ...). They are in charge of getting the trade information of each Dex and returning all the data needed on the <code>Solvers</code>.</p><blockquote><p>NOTE: The libraries contemplate the hopTokens too.</p></blockquote><ul><li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/dexes" target="_blank" rel="noopener noreferrer">All Dexes Libraries</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/dexes/bancor.ts" target="_blank" rel="noopener noreferrer">Bancor Dex Library</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/dexes/uniswap-v2.ts" target="_blank" rel="noopener noreferrer">UniswapV2 Dex Library</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="execute-script"></a>Execute script<a class="hash-link" href="#execute-script" title="Direct link to heading">#</a></h3><p>This is where everything starts. Here we will grab all the enabled trades, loop and use logic to determinate if:</p><p>1) Should the trade by executed?
2) If so, what solver should we use?
3) Once we have the solver response, execute the swap transaction provided by the solver.</p><br><ul><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/execute-mainnet-pending-trades.ts" target="_blank" rel="noopener noreferrer">Execute Mainnet pending trades</a></li><li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/execute-fantom-pending-trades.ts" target="_blank" rel="noopener noreferrer">Execute Fantom pending trades</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="execute-pending-trades-what-exactly-happens"></a>Execute pending trades: What exactly happens?<a class="hash-link" href="#execute-pending-trades-what-exactly-happens" title="Direct link to heading">#</a></h4><ol><li><p>Script execute-mainnet-pending-trades
1.1. Identify &quot;pending trades&quot;
1.2. Determinate which solver to use.
1.3. Solver determinates best Dex and returns the swap tx
1.3. Execute swap tx provided by the solver.</p></li><li><p>Call the execute in Trade Factory
2.1. Contract validates the data and that trade in configuration is valid.
2.2 Moves the funds directly from the strategy to the swapper.
2.3 Calls <code>swapper.swap()</code> to execute the trade.
2.4 Check that amount received by strategy &gt; minAmountOut provided by us.</p></li><li><p>Swapper executes the trade
3.1. Validates some data.
3.2. Executes the trade
3.3. Send funds directly to the strategy.</p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="extra-toolings"></a>Extra toolings<a class="hash-link" href="#extra-toolings" title="Direct link to heading">#</a></h3><ul><li><strong>Gas service</strong>: provides the correct params for gas options for each network</li><li><strong>Price service</strong>: we use providers as CoinGecko API to normilize the <code>tokenInAmount</code> and <code>tokenOutAmount</code> in USD so we can verify that we are not getting a bad price from the Dex we ended up using.</li></ul><br><ul><li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/utils" target="_blank" rel="noopener noreferrer">Link to services scripts</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="procedures"></a>Procedures<a class="hash-link" href="#procedures" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="add-new-strategy"></a>Add new strategy<a class="hash-link" href="#add-new-strategy" title="Direct link to heading">#</a></h3><ol><li>Add <code>STRATEGY</code> role on Trade factory contract. From yMech.</li><li>Add <code>enable trades</code> on Trade factory contract. From strategy.</li><li>Add <code>enable trade</code> on ySwap repo config (<code>fantom.ts</code> <code>mainnet.ts</code>)
3.1 To add it to the config we also need to know what solver we are going to use. It would be <code>Dexes.ts</code> which is a generic solver or it would have its own <code>Custom Solver</code>.
3.2 In case of need a <code>Custom Solver</code>, we need to code it.</li><li>Once added to config, we are ready to execute the script to swap available trades.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="remove-strategy"></a>Remove strategy<a class="hash-link" href="#remove-strategy" title="Direct link to heading">#</a></h3><ol><li>Revoke role from MS.</li><li>Remove from network config file.</li><li>OPTIONAL: remove custom solver if it has one.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="keep3r-jobs"></a>Keep3r jobs<a class="hash-link" href="#keep3r-jobs" title="Direct link to heading">#</a></h2><p>Previous knowledge about how <code>Keeper Network</code> works is needed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="procedures-1"></a>Procedures<a class="hash-link" href="#procedures-1" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="add-strategy-fantom-keeper-harvest-job"></a>Add strategy fantom keeper harvest job<a class="hash-link" href="#add-strategy-fantom-keeper-harvest-job" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="a"></a>A)<a class="hash-link" href="#a" title="Direct link to heading">#</a></h5><ol><li>Go straight to ftmscan harvest job and add the strategy manually by a yMech.</li><li>Add strategy to v2-ftm-strategies.ts config with <code>added: true</code></li></ol><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithHideOnScrollNavbar_3R7-" id="b-safest-way-to-have-everything-added"></a>B) (safest way to have everything added)<a class="hash-link" href="#b-safest-way-to-have-everything-added" title="Direct link to heading">#</a></h5><ol><li>Review and merge pr from strategists to add new strategies.</li><li>On  packages/strategies-keep3r Execute script: <code>npx hardhat run scripts/jobs/detached/01-v2-harvest-ftm-detached-job-add-strategies.ts --network fantom</code></li><li>On config file strategies-keep3r/utils/v2-ftm-strategies.ts change once again  strategies property added to true</li><li>Push changes.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_3R7-" id="remove-strategy-fantom-keeper-harvest-job"></a>Remove strategy fantom keeper harvest job<a class="hash-link" href="#remove-strategy-fantom-keeper-harvest-job" title="Direct link to heading">#</a></h4><ol><li>Go to ftmscan <code>Harvest Job SC</code> and remove the strategy manually using method <code>removeStrategies</code>. Call with a mechanic.</li><li>Remove strategy from <code>v2-NETWORK-strategies.json</code> file.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated on <b><time datetime="2022-05-17T14:40:29.000Z">5/17/2022</time></b> by <b>Marco Guaspari Worms</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/developers/v2/hacking-with-yearn"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Hacking on Yearn</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#glossary" class="table-of-contents__link">Glossary</a></li><li><a href="#components" class="table-of-contents__link">Components</a><ul><li><a href="#swappers" class="table-of-contents__link">Swappers</a></li><li><a href="#trade-factory" class="table-of-contents__link">Trade Factory</a></li><li><a href="#solvers-scripts" class="table-of-contents__link">Solvers Scripts</a></li><li><a href="#dexes-libraries" class="table-of-contents__link">Dexes Libraries</a></li><li><a href="#execute-script" class="table-of-contents__link">Execute script</a></li><li><a href="#extra-toolings" class="table-of-contents__link">Extra toolings</a></li></ul></li><li><a href="#procedures" class="table-of-contents__link">Procedures</a><ul><li><a href="#add-new-strategy" class="table-of-contents__link">Add new strategy</a></li><li><a href="#remove-strategy" class="table-of-contents__link">Remove strategy</a></li></ul></li><li><a href="#keep3r-jobs" class="table-of-contents__link">Keep3r jobs</a><ul><li><a href="#procedures-1" class="table-of-contents__link">Procedures</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items"><li class="footer__item"><a href="https://contribute.yearn.rocks/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>#strategies - Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forms.gle/Jkbu81sjAfL6NzH17" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Get Involved - Survey<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/yearn/yearn-vaults" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>yearn-vaults<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/yearn/brownie-strategy-mix" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>brownie-strategy-mix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/yearn/brownie-wrapper-mix" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>brownie-wrapper-mix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-watch" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>yearn-watch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-finance-v3" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>yearn-finance-v3<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/yearn/yearn-security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>yearn-security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Ecosystem</div><ul class="footer__items"><li class="footer__item"><a href="https://yearn.finance/vaults" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Vaults<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.yfistats.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YFI Stats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://bowswap.finance/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Bowswap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/iearnfinance" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/yearnfinance/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://medium.com/iearn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gov.yearn.finance" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://snapshot.org/#/ybaby.eth" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Snapshot voting<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.51de5865.js"></script>
<script src="/assets/js/main.a1e4fa57.js"></script>
</body>
</html>