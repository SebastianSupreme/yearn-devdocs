"use strict";(self.webpackChunkyearn_devdocs=self.webpackChunkyearn_devdocs||[]).push([[356],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return k}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),u=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=u(n),k=o,g=h["".concat(i,".").concat(k)]||h[k]||c[k]||s;return n?r.createElement(g,a(a({ref:t},d),{},{components:n})):r.createElement(g,a({ref:t},d))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=h;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var u=2;u<s;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},202:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return a},contentTitle:function(){return l},metadata:function(){return i},toc:function(){return u},default:function(){return c}});var r=n(7462),o=n(3366),s=(n(7294),n(3905)),a={},l="Risk Score",i={unversionedId:"risk-score",id:"risk-score",isDocsHomePage:!1,title:"Risk Score",description:"Risk for different strategies is measured using a point scoring system developed internally from yearn\u2019s strategy deployment process. The higher the risk score number, the more riskier the strategy is. There are 7 dimensions that are assessed in calculating the risk:",source:"@site/docs/security/risk-score.md",sourceDirName:".",slug:"/risk-score",permalink:"/security/risk-score",tags:[],version:"current",lastUpdatedBy:"defiglenn",lastUpdatedAt:1653587419,formattedLastUpdatedAt:"5/26/2022",frontMatter:{},sidebar:"mySidebar",previous:{title:"Multisig",permalink:"/security/multisig"}},u=[],d={toc:u};function c(e){var t=e.components,n=(0,o.Z)(e,["components"]);return(0,s.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"risk-score"},"Risk Score"),(0,s.kt)("p",null,"Risk for different strategies is measured using a point scoring system developed internally from yearn\u2019s strategy deployment process. The higher the risk score number, the more riskier the strategy is. There are 7 dimensions that are assessed in calculating the risk:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Audit"),(0,s.kt)("li",{parentName:"ul"},"Code Review "),(0,s.kt)("li",{parentName:"ul"},"Complexity "),(0,s.kt)("li",{parentName:"ul"},"Longevity "),(0,s.kt)("li",{parentName:"ul"},"Protocol Safety"),(0,s.kt)("li",{parentName:"ul"},"Team Knowledge"),(0,s.kt)("li",{parentName:"ul"},"Testing Score")),(0,s.kt)("p",null,"The Risk score take all these into account and multiplies by the TVL Impact, so the final formula is:"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Likelihood")," = (Audit + Code Review + Complexity + Longevity + Protocol Safety + Team Knowledge + Testing Score)"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Risk Score "),"= Likelihood * TVL Impact"),(0,s.kt)("p",null,"This risk framework was developed as an ongoing process that never ends regarding management of security dimensions and TVL of yearn\u2019s strategies. The security team realised that given yearn\u2019s unique approach to deploying strategies on a constant basis it couldn\u2019t rely on a heavy waterfall process (heavy analysis/design, testing, several audits before a release, etc) to deploy contracts. The strategies are deployed and capped by their risk score and as we mitigate each dimension and improve something in the scoring the strategy can grow its TVL, think of it as calculated bets based on our internal security process. This allows yearn to compare the risk score of two strategies and prioritise mitigations/preventive actions like forming a committee to spread knowledge on the code, get more audits, migrate current code for improved versions of the strat, etc. "),(0,s.kt)("p",null,"The current version works for yearn\u2019s current needs but we are always looking to improve it and also extend this scoring system to the vaults to be able to get a weighted average risk score that makes reasonable assumptions and can help our users get informed around what\u2019s going on behind the scenes in the vaults. Vault risk scoring is still under development at the moment."),(0,s.kt)("p",null,"First dimension is audits. This is the process by which either an audit firm or an external security researcher reviews the code for any potential vulnerabilities and presents a report for mitigation. As audits usually take longer than an internal security review and are not immediately available given demand for audits in the space, most strategies are sent to production with no audits (thus high risk score) to keep their TVL limited. This strikes a balance of validating the strategy in production with a calculated risk while we schedule a proper audit. The risk score overall helps us prioritize which strategies should get audited first, based on impact and other dimensions on scoring."),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Audit"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"No audit by a trusted firm or security researcher")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"Audit by trusted firm or security researcher took place 6 months+ ago")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"Audit by trusted firm or security researcher took place 3 months+ ago")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"Audit less than 3 months ago. Independent audit by a trusted firm.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"Audit less than 3 months ago. In total, 3 or more independent audits by trusted firms."))),(0,s.kt)("p",null,"Second, we\u2019ve got code review. This is the process that blocks a strategy from going to production. Is done in two major phases, phase 1 consisting of  2 internal peers (2 strategists) reviewing the strategy for any potential issues regarding functionality and logical issues regarding handling of account, profits, losses, etc. After this phase is completed usually the strategy can go to ape.tax for live testing and validation. For phase 2 an internal security reviewer from yearn will review the code focusing more on security concerns. Once phase 2 is completed, the strategy gets a risk score in all dimensions and is usually deemed enough for a strategy to go to production with limited TVL based on scoring. After these steps a recurring review is scheduled, where either a second either internal or external security reviewer will have another look at the code. Here\u2019s a table to showcase the scoring:"),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Code Review"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"0 - 1 reviewer of the code only or most recent was done 6 months+ ago")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"2 reviewers of the code, the most recent of which was done 3+ months ago")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"3 reviewers of the code, the most recent of which was done 3+ months ago (1 of the reviewers is an internal security dev)")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"4 reviewers of the code (2 peers and 2 internal security devs)")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"5 reviewers of the code, (2 strategists peers and 2 security reviewers and either external protocol devs reviewed or external security researchers reviewed)"))),(0,s.kt)("p",null,"Next up, complexity. This is how the strategy earns a return - is it a simple strategy like a masterchef staking or does it have complex mechanics like leverage, risk of liquidation, many protocols involved, etc? The more pieces and components it needs will require a higher complexity score. This score is key in an emergency to evaluate how difficult it is to mitigate a live issue.The scores are below:"),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Complexity"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"Strategy is very complex, uses leverage or debt, not easy to unwind. No health check")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"Uses leverage or debt, not easy to unwind. No health check")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"Has loss potential, withdrawal fee or requires detailed queue management to avoid losses. No health check")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"Strategy is simple, easy to migrate/unwind. Has health check")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"Strategy is simple, easy to migrate/unwide. No leverage and zero public unrestricted methods. Is highly unlikely to have a loss."))),(0,s.kt)("p",null,"Longevity is how long the strategy has been running live on yearn.finance. Here\u2019s the scores:"),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Longevity"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"New code. Did not go to ape tax before going live on yearn.finance")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"Code has been live less than a month")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"Code has been live 1-4 months")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"Code live 4+ months")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"Code live 8+ months. No critical issues and no changes in code base over this time"))),(0,s.kt)("p",null,"Up next, protocol safety. This is meant as an internal evaluation from yearn\u2019s point of view of how resilient is the protocol the strategy works with regarding safety measures given the current DeFi security standards. It is heavily based on informed opinions regarding our internal assessments and due diligence compared to the top projects in DeFI. Accounts among other things for multisig health, decentralisation, bounty programs, audits, etc. "),(0,s.kt)("p",null,"We hope to improve this dimension with the help of the security and overall DeFI community to potentially use a standard scoring system that is widely accepted in the ecosystem to replace our current scoring table."),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Protocol Safety"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"No due diligence (DD) document for this strategy. The protocol contracts used are very recent and not audited/verified. An EOA (externally owned account) owns the contracts and can upgrade them.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"DD took place. Protocol contracts audited/verified. A multisig is required or contracts are Upgradable. Multisig has a low threshold of signers. No bounty program.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"DD took place. Protocol contracts are audited/verified by at least ",(0,s.kt)("strong",null,"one reputable audit "),"firm. A multisig with a good threshold is required and/or contracts are immutable. Has a good bounty program.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"DD took place. Currently deployed protocol contracts are audited/verified by at least ",(0,s.kt)("strong",null,"two reputable audit "),"firms. A multisig with a good threshold is required and/or contracts are immutable. Has a good bounty program.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"Protocols involved in contracts are trusted blue chip protocols with a good record of security. For example: Maker, Uniswap, Curve, AAVE, and Compound. These protocols handle at least all the criteria specified in item 2 and more."))),(0,s.kt)("p",null,"Team knowledge is about how the expertise of the strategy is shared amongst Yearn contributors. How many contributors can manage the strategy and respond in an emergency. The less people can manage and respond during an emergency the riskier the strategy assessment in this dimension."),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Team Knowledge"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"1 person in the team is the only one that has in-depth knowledge of the strategy code")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"1 strategist has in-depth knowledge, and 1 strategist is somewhat familiar with the strategy code.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"2 strategists have in-depth knowledge of the strategy code.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"2 strategists have in-depth knowledge, and 1 strategist is somewhat familiar with the strategy code.")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"Team of 3+ strategists are very familiar with the strategy code and the protocol the strategy is utilising."))),(0,s.kt)("p",null,"Testing score is a metric of how much of the codebase for the strategy has been tested and uses the test coverage number as a reference. The higher the coverage means that the developer/strategist took time to test most of the operations of the strategy in a unit test or fork environment. This score assumes a less tested strategy entails more risk since it increases chances something was missed in normal operation of the strategy or other potential edge cases like a bug in the strategy\u2019s accounting, a missed assumption about the underlying protocol, a hack or unexpected bad state on the underlying protocol, etc."),(0,s.kt)("table",null,(0,s.kt)("tr",null,(0,s.kt)("td",null,(0,s.kt)("strong",null,"Score")),(0,s.kt)("td",null,(0,s.kt)("strong",null,"Testing Score"))),(0,s.kt)("tr",null,(0,s.kt)("td",null,"5"),(0,s.kt)("td",null,"Less than 20% coverage in testing")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"4"),(0,s.kt)("td",null,"Less than 40% coverage in testing")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"3"),(0,s.kt)("td",null,"40% to 80% coverage")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"2"),(0,s.kt)("td",null,"Over 80% coverage")),(0,s.kt)("tr",null,(0,s.kt)("td",null,"1"),(0,s.kt)("td",null,"Over 90% coverage in testing. Second developer validated and added tests and also added new ones for uncovered cases while reviewing. You can pull repository and test are currently passing"))),(0,s.kt)("p",null,"The TVL (total value locked) impact is a figure between 1 and 5 as well, where 5 is the highest impact labelled \u201cextreme\u201d (above 100MM) and 1 is the lowest impact in TVL less than 1MM. This table was proposed as a way to measure how to allocate to new riskier strategies without having a catastrophic event in case of a hack or issue. The lower the impact the more likely yearn\u2019s treasury can recover from an incident. The TVL is measured in USD and grows dynamically based on strategies allocations onchain. Through ",(0,s.kt)("a",{parentName:"p",href:"https://yearn.watch/"},"yearn.watch")," we keep track of the TVL and risk score to make fund allocation decisions and mitigations in case a strategy group has fallen into the \u201cred\u201d high risk zone. "),(0,s.kt)("p",null,"Overall the risk framework turns yearn strategy deployment into a constant never ending preventive process of assessing and mitigating risks."))}c.isMDXComponent=!0}}]);